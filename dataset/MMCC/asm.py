import numpy as np


class ASM:
    def __init__(self, file_path: str):
        self._file_path = file_path

        # Assembly
        self.asm_commands_call = 0
        self.asm_commands_add = 0
        self.asm_commands_cdq = 0
        self.asm_commands_cld = 0
        self.asm_commands_cli = 0
        self.asm_commands_cmc = 0
        self.asm_commands_cmp = 0
        self.asm_commands_cwd = 0
        self.asm_commands_daa = 0
        self.asm_commands_dd = 0
        self.asm_commands_dec = 0
        self.asm_commands_dw = 0
        self.asm_commands_endp = 0
        self.asm_commands_faddp = 0
        self.asm_commands_fchs = 0
        self.asm_commands_fdiv = 0
        self.asm_commands_fdivr = 0
        self.asm_commands_fistp = 0
        self.asm_commands_fld = 0
        self.asm_commands_fstp = 0
        self.asm_commands_fword = 0
        self.asm_commands_fxch = 0
        self.asm_commands_imul = 0
        self.asm_commands_in = 0
        self.asm_commands_inc = 0
        self.asm_commands_ins = 0
        self.asm_commands_jb = 0
        self.asm_commands_je = 0
        self.asm_commands_jg = 0
        self.asm_commands_jl = 0
        self.asm_commands_jmp = 0
        self.asm_commands_jnb = 0
        self.asm_commands_jno = 0
        self.asm_commands_jo = 0
        self.asm_commands_jz = 0
        self.asm_commands_lea = 0
        self.asm_commands_mov = 0
        self.asm_commands_mul = 0
        self.asm_commands_not = 0
        self.asm_commands_or = 0
        self.asm_commands_out = 0
        self.asm_commands_outs = 0
        self.asm_commands_pop = 0
        self.asm_commands_push = 0
        self.asm_commands_rcl = 0
        self.asm_commands_rcr = 0
        self.asm_commands_rep = 0
        self.asm_commands_ret = 0
        self.asm_commands_rol = 0
        self.asm_commands_ror = 0
        self.asm_commands_sal = 0
        self.asm_commands_sar = 0
        self.asm_commands_sbb = 0
        self.asm_commands_scas = 0
        self.asm_commands_shl = 0
        self.asm_commands_shr = 0
        self.asm_commands_sidt = 0
        self.asm_commands_stc = 0
        self.asm_commands_std = 0
        self.asm_commands_sti = 0
        self.asm_commands_stos = 0
        self.asm_commands_sub = 0
        self.asm_commands_test = 0
        self.asm_commands_wait = 0
        self.asm_commands_xchg = 0
        self.asm_commands_xor = 0

        self._extract_assembly_features()

    def _extract_assembly_features(self):
        with open(self._file_path, "rb") as f:
            asm = f.read()

        asm = asm.split(b"\n")
        
        for line in asm:
            line = line.split()
            if len(line) != 0:
                if b"add" in line:
                    self.asm_commands_add += 1
                elif b"call" in line:
                    self.asm_commands_call += 1
                elif b"cdq" in line:
                    self.asm_commands_cdq += 1
                elif b"cld" in line:
                    self.asm_commands_cld += 1
                elif b"cli" in line:
                    self.asm_commands_cli += 1
                elif b"cmc" in line:
                    self.asm_commands_cmc += 1
                elif b"cmp" in line:
                    self.asm_commands_cmp += 1
                elif b"cwd" in line:
                    self.asm_commands_cwd += 1
                elif b"daa" in line:
                    self.asm_commands_daa += 1
                elif b"dd" in line:
                    self.asm_commands_dd += 1
                elif b"dec" in line:
                    self.asm_commands_dec += 1
                elif b"dw" in line:
                    self.asm_commands_dw += 1
                elif b"endp" in line:
                    self.asm_commands_endp += 1
                elif b"faddp" in line:
                    self.asm_commands_faddp += 1
                elif b"fchs" in line:
                    self.asm_commands_fchs += 1
                elif b"fdiv" in line:
                    self.asm_commands_fdiv += 1
                elif b"fdivr" in line:
                    self.asm_commands_fdivr += 1
                elif b"fistp" in line:
                    self.asm_commands_fistp += 1
                elif b"fld" in line:
                    self.asm_commands_fld += 1
                elif b"fstp" in line:
                    self.asm_commands_fstp += 1
                elif b"fword" in line:
                    self.asm_commands_fword += 1
                elif b"fxch" in line:
                    self.asm_commands_fxch += 1
                elif b"imul" in line:
                    self.asm_commands_imul += 1
                elif b"in" in line:
                    self.asm_commands_in += 1
                elif b"inc" in line:
                    self.asm_commands_inc += 1
                elif b"ins" in line:
                    self.asm_commands_ins += 1
                elif b"jb" in line:
                    self.asm_commands_jb += 1
                elif b"je" in line:
                    self.asm_commands_je += 1
                elif b"jg" in line:
                    self.asm_commands_jg += 1
                elif b"jl" in line:
                    self.asm_commands_jl += 1
                elif b"jmp" in line:
                    self.asm_commands_jmp += 1
                elif b"jnb" in line:
                    self.asm_commands_jnb += 1
                elif b"jno" in line:
                    self.asm_commands_jno += 1
                elif b"jo" in line:
                    self.asm_commands_jo += 1
                elif b"jz" in line:
                    self.asm_commands_jz += 1
                elif b"lea" in line:
                    self.asm_commands_lea += 1
                elif b"mov" in line:
                    self.asm_commands_mov += 1
                elif b"mul" in line:
                    self.asm_commands_mul += 1
                elif b"not" in line:
                    self.asm_commands_not += 1
                elif b"or" in line:
                    self.asm_commands_or += 1
                elif b"out" in line:
                    self.asm_commands_out += 1
                elif b"outs" in line:
                    self.asm_commands_outs += 1
                elif b"pop" in line:
                    self.asm_commands_pop += 1
                elif b"push" in line:
                    self.asm_commands_push += 1
                elif b"rcl" in line:
                    self.asm_commands_rcl += 1
                elif b"rcr" in line:
                    self.asm_commands_rcr += 1
                elif b"rep" in line:
                    self.asm_commands_rep += 1
                elif b"ret" in line:
                    self.asm_commands_ret += 1
                elif b"rol" in line:
                    self.asm_commands_rol += 1
                elif b"ror" in line:
                    self.asm_commands_ror += 1
                elif b"sal" in line:
                    self.asm_commands_sal += 1
                elif b"sar" in line:
                    self.asm_commands_sar += 1
                elif b"sbb" in line:
                    self.asm_commands_sbb += 1
                elif b"scas" in line:
                    self.asm_commands_scas += 1
                elif b"shl" in line:
                    self.asm_commands_shl += 1
                elif b"shr" in line:
                    self.asm_commands_shr += 1
                elif b"sidt" in line:
                    self.asm_commands_sidt += 1
                elif b"stc" in line:
                    self.asm_commands_stc += 1
                elif b"std" in line:
                    self.asm_commands_std += 1
                elif b"sti" in line:
                    self.asm_commands_sti += 1
                elif b"stos" in line:
                    self.asm_commands_stos += 1
                elif b"sub" in line:
                    self.asm_commands_sub += 1
                elif b"test" in line:
                    self.asm_commands_test += 1
                elif b"wait" in line:
                    self.asm_commands_wait += 1
                elif b"xchg" in line:
                    self.asm_commands_xchg += 1
                elif b"xor" in line:
                    self.asm_commands_xor += 1

    @property
    def assembly_features(self) -> np.ndarray:
        return np.array([
            self.asm_commands_call, self.asm_commands_add, self.asm_commands_cdq, self.asm_commands_cld,
            self.asm_commands_cli, self.asm_commands_cmc, self.asm_commands_cmp, self.asm_commands_cwd,
            self.asm_commands_daa, self.asm_commands_dd, self.asm_commands_dec, self.asm_commands_dw,
            self.asm_commands_endp, self.asm_commands_faddp, self.asm_commands_fchs, self.asm_commands_fdiv,
            self.asm_commands_fdivr, self.asm_commands_fistp, self.asm_commands_fld, self.asm_commands_fstp,
            self.asm_commands_fword, self.asm_commands_fxch, self.asm_commands_imul, self.asm_commands_in,
            self.asm_commands_inc, self.asm_commands_ins, self.asm_commands_jb, self.asm_commands_je,
            self.asm_commands_jg, self.asm_commands_jl, self.asm_commands_jmp, self.asm_commands_jnb,
            self.asm_commands_jno, self.asm_commands_jo, self.asm_commands_jz, self.asm_commands_lea,
            self.asm_commands_mov, self.asm_commands_mul, self.asm_commands_not, self.asm_commands_or,
            self.asm_commands_out, self.asm_commands_outs, self.asm_commands_pop, self.asm_commands_push,
            self.asm_commands_rcl, self.asm_commands_rcr, self.asm_commands_rep, self.asm_commands_ret,
            self.asm_commands_rol, self.asm_commands_ror, self.asm_commands_sal, self.asm_commands_sar,
            self.asm_commands_sbb, self.asm_commands_scas, self.asm_commands_shl, self.asm_commands_shr,
            self.asm_commands_sidt, self.asm_commands_stc, self.asm_commands_std, self.asm_commands_sti,
            self.asm_commands_stos, self.asm_commands_sub, self.asm_commands_test, self.asm_commands_wait,
            self.asm_commands_xchg, self.asm_commands_xor
        ], dtype=np.int32)
